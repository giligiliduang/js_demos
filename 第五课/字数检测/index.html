<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="main.css">
    <title>简单demo</title>
</head>

<body>
    <div id="box">
        <textarea name="" id="" cols="50" rows="5"></textarea>
        还可输入<span id="word"></span>字
    </div>
    <script>
        function WordCount() {
            this.area = document.getElementsByTagName('textarea')[0]
            this.totalWord = document.getElementById('word')
            this.splitLength = 0 //存储需要截断的长度
            var self = this
            var re = /^[\u4e00-\u9fa5]+$/
            this.count = function (s) {
                var zh = 0
                var en = 0
                var s_arr = s.split('')
                s_arr.forEach(function (item) {
                    if (re.test(item)) {
                        zh += 1
                    } else {
                        en += 1
                    }
                })
                var total = zh + Math.ceil(en / 2)
                return total
            }
            this.formChange = function (length) {
                var trigger = false
                var inputhandler = this.area.addEventListener('input', function () {
                    var text = self.area.value
                    var total = self.count(text)
                    if (total <= length) {
                        self.totalWord.innerText = length - total
                        self.splitLength = text.length
                    } else {
                        self.area.value = text.substr(0, self.splitLength)
                    }

                })
                // this.area.onblur=function(){
                //     console.log('shabiu')
                //     self.totalWord.innerText=""
                //     self.area.value=""
                // }
            }
            this.init = function () {
                this.formChange(10)
            }
        }
        (new WordCount).init()
    </script>
</body>

</html>