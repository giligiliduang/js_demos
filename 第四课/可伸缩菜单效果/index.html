<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="main.css">
    <title>Document</title>
</head>

<body>
    <div class="main">
        <ul>
            <li>第1课</li>
            <li>第2课</li>
            <li>第3课</li>
            <li>第4课</li>
            <li>第5课</li>
            <li>第6课</li>
            <li>第7课</li>
            <li>第8课</li>
            <li>第9课</li>
            <li>第10课</li>
        </ul>
        <ul>
            <li>第2课</li>
            <li>第3课</li>
            <li>第4课</li>
            <li>第5课</li>
            <li>第6课</li>
            <li>第7课</li>
            <li>第8课</li>
            <li>第9课</li>
            <li>第10课</li>
        </ul>
        <ul>
            <li>第3课</li>
            <li>第4课</li>
            <li>第5课</li>
            <li>第6课</li>
            <li>第7课</li>
            <li>第8课</li>
            <li>第9课</li>
            <li>第10课</li>
        </ul>
    </div>
    <script>
        //关键逻辑，每次打开tab都要检查之前的是否关闭了,只要打开了新的tab就要重新设置lastopen
        class Collapse {
            constructor() {
                this.uls = document.querySelectorAll('ul')
                this.baseHeight = this.uls[0].offsetHeight
                this.curshow = false
                this.clickd=false
                this.lastopen = null
            }
            changeHeight() {
                this.uls.forEach((item, index) => {
                    item.onclick = e => {
                        let liHeight = item.children[0].offsetHeight //每个li的高度
                        let totalHeight = item.childElementCount * liHeight //要到达的高度
                        // let start=item.children[0].offsetHeight
                        // let step = parseInt(totalHeight * 0.01)*3
                        // let percent90 = parseInt(totalHeight * 0.9)
                        // let time = 10//每走一步需要的时间
                        // let handle=setInterval(()=>{
                        //     start+=step
                        //     item.style.height=start+'px'
                        //     if(start===totalHeight){
                        //         clearInterval(handle)
                        //     }
                        // },time)
                        // if(this.lastopen!==null && this.lastopen!=index){
                        //         this.closeTab(this.uls[this.lastopen])
                        //         this.openTab(item)
                        //     }
                            let children=Array.from(item.children)
                            let first_child=children[0]
                            let other=children.slice(1,children.length)
                            
                            if (!this.curshow) {
                            if(this.lastopen!==null){
                                first_child.removeAttribute("style")
                                other.forEach(item=>{item.removeAttribute("style")})
                                this.closeTab(this.uls[this.lastopen])
                                this.clickd=false
                            }
                            first_child.style.backgroundColor="blue"
                            other.forEach((item)=>{item.style.backgroundColor="skyblue"})
                            this.openTab(item, totalHeight)
                            this.lastopen = index //记录上一个打开的章节
                            this.curshow = true
                        } else {
                           this.closeTab(this.uls[this.lastopen])
                           if(index!==this.lastopen){
                               this.openTab(item,totalHeight)
                               first_child.style.backgroundColor="blue"
                               other.forEach((item)=>{item.style.backgroundColor="skyblue"})
                               this.lastopen=index
                           }
                           this.curshow=false
                        }
                        
                    
                        
                        console.log(this.curshow)

                    }
                })
            }
            openTab(item, height) {
                item.style.height = height + "px"
                if(!item.style.transition){
                    item.style.transition = "height 0.3s"
                }
                
            }
            closeTab(item) {
                item.style.height = this.baseHeight + "px"
            }

            init() {
                this.changeHeight()
            }

        }
        let obj = new Collapse()
        obj.init()
    </script>
</body>

</html>