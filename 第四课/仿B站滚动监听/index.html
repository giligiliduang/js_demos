<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="main.css">
    <title>Document</title>
</head>

<body>
    <div class="top"></div>
    <div class="main">
        <div class="fanju"></div>
        <div class="animate"></div>
        <div class="live"></div>
        <div class="guochuang"></div>
        <div class="music"></div>
        <div class="video"></div>
        <div class="audio"></div>
        <div class="dance"></div>
        <div class="game"></div>
        <div class="sicence"></div>
    </div>
    <div id="side">
        <ul>
            <li>1</li>
            <li>2</li>
            <li>3</li>
            <li>4</li>
            <li>5</li>
            <li>6</li>
            <li>7</li>
            <li>8</li>
            <li>9</li>
            <li>10</li>
        </ul>
    </div>

    <script>
        var side = document.getElementsByTagName('ul')[0]
        var divs = document.querySelectorAll('.main div')
        var lis=document.getElementsByTagName('li')
        lis=Array.from(lis)
        divs = Array.from(divs)
        let heights=[]
        divs.forEach(function(item){
            heights.push(item.offsetTop)
        })
        function getNear(arr,item){
            switch(arr.length){
                case 0: throw new Error('arr cant be empty');break;
                case 1: return 0; break;
            }
            if(item<arr[0]){
                return 0
            }
            else if(item>arr[arr.length-1]){
                return arr.length-1
            }
            for(var i=1;i<arr.length;i++){
                if(item>=arr[i-1]&&item<arr[i]){
                    var index=i-1
                }
            }
            return index
        }


        document.onscroll = function () {
            if (document.body.scrollTop > 150) {
                side.style.top = "0px"
                var curtop=document.body.scrollTop
                var liIndex=getNear(heights,curtop)
                if(liIndex){
                    var li=lis[liIndex]
                    li.classList.add("current")
                    lis.forEach(function(item){
                        if(item!==li){
                            item.classList.remove("current")
                        }
                    })
                }
                
            } else {
                side.style.top = "200px"
                lis.forEach(function(item){
                    item.className=""
                })
            }
        }
        lis.forEach(function(item,index){
            item.onclick=function(){
                var distance=heights[index]-250
                scrollTo(0,distance)
            }
        })

    </script>
</body>

</html>