<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="main.css">
    <title>Document</title>
</head>

<body>
    <div class="wrap wrap-sm">
        <div class="header">
            <h1>yo.</h1>
        </div>
        <div class="form">
            <form action="">
                <div class="input-wrap">
                    <label for="">姓名</label>
                    <input type="text" class="input-control">
                    <div class="input-error">姓名格式有误</div>
                </div>
                <div class="input-wrap">
                    <label for="">用户名</label>
                    <input type="text" class="input-control">
                    <div class="input-error">用户名格式有误</div>
                </div>
                <div class="input-wrap">
                    <label for="">邮箱</label>
                    <input type="text" class="input-control">
                    <div class="input-error">邮箱格式有误</div>
                </div>
                <div class="input-wrap">
                    <label for="">密码</label>
                    <input type="password" class="input-control">
                    <div class="input-error">密码格式有误</div>
                </div>
                <div class="input-wrap">
                    <label for="">确认密码</label>
                    <input type="password" class="input-control">
                    <div class="input-error"></div>
                </div>
                <div class="input-wrap">
                    <label for="sex">性别</label>
                    <span>男</span> <input type="radio" name="sex">
                    <span>女</span> <input type="radio" name="sex">
                </div>
                <div class="input-wrap">
                    <button id='register'>注册</button>
                </div>
            </form>
        </div>
    </div>
    <script>
        /*
        简单表单验证，用户名，邮箱，密码
        1.错误需要给出提示,
        2.blur之后自动去除输入的空格
        3.密码为空，确认密码无法输入
        4.验证两次输入是否完全一致
        */
        (function () {
            function Validate() {
                var self = this
                this.rules = {
                    'name': /[\u4e00-\u9fa5]{2,3}/,
                    'uname': /^[\d\w_][\w\d]{5,}$/g,
                    'email': /[\d\w]+@[\d\w]+\.\w+(?:\.\w+)?/g,
                    'pword': /^[\d\w,\.\?'";:!]{6,14}$/g,
                }
                this.rnames = ['name','uname','email','pword']
                this.errors = ['姓名格式有误', '用户名格式错误', '邮箱格式错误', '密码格式错误']
                this.prompts = Array.prototype.slice.call(document.querySelectorAll('.input-error'), 0)
                this.inputs = Array.prototype.slice.call(document.querySelectorAll('.input-control'), 0)
                this.submit = document.getElementById('register')
                this.onBlur = function () {
                    var commonInputs = this.inputs.slice(0, 4)
                    var passwordInput = this.inputs.slice(3, 4)
                    var ensurepasswordInput=this.inputs.slice(4,5)
                    commonInputs.forEach(function (item, index) {
                        item.onblur = function (e) {
                            console.log('dwf')
                            var val = item.value && self.stripWhiteSpace(item.value)
                            var res = self.validate(val, self.rnames[index])
                            item.value = val
                            var prompt = self.prompts[index]
                            if (!res) {
                                //验证失败
                                self.changePrompt(prompt, self.errors[index])
                                prompt.style.display = "block"
                            } else {
                                self.changePrompt(prompt, '')
                                prompt.style.display = "none"
                            }
                        }
                    })
                    passwordInput.oninput=function(e){
                        if(passwordInput.value===''){
                            ensurepasswordInput.disable=true
                        }else{
                            ensurepasswordInput.disable=false
                        }
                    }
                   ensurepasswordInput.onblur=function(e){
                        var val=passwordInput.value
                        var ensureval=ensurepasswordInput.value && self.stripWhiteSpace(ensurepasswordInput.value)
                        var res=self.validate(ensureval,self.rnames[self.rnames.length-1])
                        var prompt=self.prompts[4]
                        if (!res) {
                                //验证失败
                                self.changePrompt(prompt, self.errors[index])
                                prompt.style.display = "block"
                            } else {
                                if(val!==ensureval){
                                    self.changePrompt(prompt,'两次输入的密码不一致')
                                }
                                else{
                                    self.changePrompt(prompt, '')
                                    prompt.style.display = "none"
                                }
                            }
                    }

                }
                this.init = function () {
                    self.onBlur()
                }
            }
            Validate.prototype = {
                constructor: Validate,
                validate: function (string, rname) {
                    if (!string) {
                        return true
                    }
                    return this.rules[rname].test(string)
                },
                changePrompt: function (elem, msg) {
                    elem.innerText = msg
                },
                stripWhiteSpace:function(str){
                    return str.split('').filter(item => {return item !== ' '}).join('')
                }
            }
            window.Validate = Validate
        })()
        var va = new Validate()
        va.onBlur()
    </script>
</body>

</html>